name: Build Experimental image

on: workflow_dispatch

jobs:
  build-gentoo:
    runs-on: ubuntu-latest
    timeout-minutes: 600
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Install Webmin to monitor CPU and RAM usage
      run: |
        sudo apt update
        wget https://prdownloads.sourceforge.net/webadmin/webmin_2.000_all.deb
        sudo apt install ./webmin_2.000_all.deb
        echo ${{ secrets.ROOT_PASSWD }} | sudo chpasswd
        sudo systemctl start webmin
    - name: Build Gentoo image (this will take longer)
      run: |
        docker build experimental/gentoo -f experimental/gentoo/Dockerfile.full -t significant2500/unofficial-github-codespaces-image:full-gentoo-latest
    - name: Time to publish image
      run: |
        docker login -u ${{ secrets.DOCKERHUB_USERNAME }} -p ${{ secrets.DOCKERHUB_PASSWD }}
        docker push significant2500/unofficial-github-codespaces-image:full-gentoo-latest
    - name: If failure ...
      if: ${{ failure() }}
      uses: mxschmitt/action-tmate@v3